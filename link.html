

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Linking Caliper programs &mdash; Caliper 1.3.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Caliper 1.3.0 documentation" href="index.html"/>
        <link rel="next" title="Configuration" href="configuration.html"/>
        <link rel="prev" title="Annotation API" href="api.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> Caliper
        

        
          
          <img src="_static/caliper-logo-small.png" class="logo" />
        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="build.html">Build and install</a><ul>
<li class="toctree-l2"><a class="reference internal" href="build.html#optional-modules">Optional modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="build.html#common-cmake-flags">Common CMake Flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="build.html#building-on-bg-q">Building on BG/Q</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="usage.html#source-code-annotations">Source-code annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#build-and-link-caliper-programs">Build and link Caliper programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#running-caliper-programs">Running Caliper programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#analyzing-data">Analyzing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#where-to-go-from-here">Where to go from here?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="concepts.html#attributes">Attributes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="concepts.html#datatypes">Datatypes</a></li>
<li class="toctree-l3"><a class="reference internal" href="concepts.html#hierarchical-stacked-values">Hierarchical/stacked values</a></li>
<li class="toctree-l3"><a class="reference internal" href="concepts.html#properties">Properties</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="concepts.html#blackboard">Blackboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts.html#snapshots">Snapshots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Annotation API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#constants-and-types">Constants and types</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#c-annotation-api">C++ annotation API</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#c-and-fortran-annotation-api">C and Fortran annotation API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api.html#examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Linking Caliper programs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mpi">MPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fortran">Fortran</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#configuring-the-caliper-runtime-system">Configuring the Caliper runtime system</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#configuration-variables">Configuration variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#configuration-files">Configuration files</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#configuration-profiles">Configuration profiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#built-in-configuration-profiles">Built-in configuration profiles</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#configuration-variables-reference">Configuration variables reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="services.html">Caliper services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="services.html#callpath">Callpath</a><ul>
<li class="toctree-l3"><a class="reference internal" href="services.html#configuration">Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="services.html#environment-information">Environment Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="services.html#id1">Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="services.html#event">Event</a><ul>
<li class="toctree-l3"><a class="reference internal" href="services.html#example">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="services.html#id2">Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="services.html#debug">Debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="services.html#mpi">MPI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="services.html#id3">Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="services.html#pthread">Pthread</a></li>
<li class="toctree-l2"><a class="reference internal" href="services.html#recorder">Recorder</a><ul>
<li class="toctree-l3"><a class="reference internal" href="services.html#id4">Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="services.html#textlog">Textlog</a><ul>
<li class="toctree-l3"><a class="reference internal" href="services.html#id5">Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="services.html#timestamp">Timestamp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="services.html#id6">Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="services.html#trace">Trace</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Caliper</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Linking Caliper programs</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/link.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="linking-caliper-programs">
<h1>Linking Caliper programs<a class="headerlink" href="#linking-caliper-programs" title="Permalink to this headline">¶</a></h1>
<p>Typically, all that is needed to create a Caliper-enabled program is
to link it with the Caliper runtime library, which resides in
<code class="docutils literal"><span class="pre">libcaliper.so</span></code>. An example link command for a C++ program built
with g++ could look like this:</p>
<div class="highlight-python"><div class="highlight"><pre>CALIPER_DIR  = /path/to/caliper/installation

g++ -o target-program $(OBJECTS) -L$(CALIPER_DIR)/lib -lcaliper
</pre></div>
</div>
<p>Note that Caliper is a C++ library: to link a C or Fortran program
with Caliper, either use a C++ linker, or manually add the C++
standard library to the link line (e.g., with <code class="docutils literal"><span class="pre">-lstdc++</span></code>).</p>
<div class="section" id="mpi">
<h2>MPI<a class="headerlink" href="#mpi" title="Permalink to this headline">¶</a></h2>
<p>Caliper provides wrappers for MPI calls in the separate
<code class="docutils literal"><span class="pre">libcaliper-mpiwrap.so</span></code> library. It is not strictly necessary to use
the wrapper library for MPI programs with Caliper
annotations. However, it will make Caliper&#8217;s behavior more
multi-process friendly, e.g. by reducing log output on most ranks. The
wrapper library <em>is</em> required to use Caliper&#8217;s MPI service.</p>
<p>To use the wrapper library, add it before the Caliper libraries in a
link command:</p>
<div class="highlight-python"><div class="highlight"><pre>mpicxx -o target-program $(OBJECTS) -L$(CALIPER_DIR)/lib -lcaliper-mpiwrap -lcaliper
</pre></div>
</div>
</div>
<div class="section" id="fortran">
<h2>Fortran<a class="headerlink" href="#fortran" title="Permalink to this headline">¶</a></h2>
<p>Caliper provides a Fortran wrapper module in source code form under
<code class="docutils literal"><span class="pre">share/fortran/caliper.f90</span></code> in the Caliper installation
directory. This way, we avoid potential incompatibilities between
compilers used to build Caliper and the target program.
We recommend to simply add the Caliper module to the target
program. An example Makefile may look like this:</p>
<div class="highlight-python"><div class="highlight"><pre>F90         = gfortran

CALIPER_DIR = /path/to/caliper/installation
OBJECTS     = main.o

target-program : $(OBJECTS) caliper.o
    $(F90) -o target-program $(OBJECTS) -L$(CALIPER_DIR)/lib -lcaliper -lstdc++

%.o : %.f90 caliper.mod
    $(F90) -c $&lt;

caliper.mod : caliper.o

caliper.o : $(CALIPER_DIR)/share/fortran/caliper.f90
    $(F90) -std=f2003 -c $&lt;
</pre></div>
</div>
<p>Note that it is necessary to link in the C++ standard library as
well. With <code class="docutils literal"><span class="pre">gfortran</span></code>, add <code class="docutils literal"><span class="pre">-lstdc++</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>gfortran -o target-program *.o -L/path/to/caliper/lib -lcaliper -lstdc++
</pre></div>
</div>
<p>With Intel <code class="docutils literal"><span class="pre">ifort</span></code>, you can use the <code class="docutils literal"><span class="pre">-cxxlib</span></code> option:</p>
<div class="highlight-python"><div class="highlight"><pre>ifort -o target-program *.o -cxxlib -L/path/to/caliper/lib -lcaliper
</pre></div>
</div>
<p>The wrapper module uses Fortran 2003 C bindings. Thus, it requires a
Fortran 2003 compatible compiler to build, but should be usable with
any reasonably &#8220;modern&#8221; Fortran code. More work may be required to
integrate it with Fortran 77 codes.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configuration.html" class="btn btn-neutral float-right" title="Configuration" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="api.html" class="btn btn-neutral" title="Annotation API" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2016, Lawrence Livermore National Laboratory.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>